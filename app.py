import streamlit as st
import time

st.set_page_config(page_title="–û—Ä–≥–∞–Ω–∏–∫–∞–ª—ã“õ —Ö–∏–º–∏—è: –°–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è–ª–∞—Ä", layout="wide")

# ---------------- SIDEBAR ----------------
st.sidebar.title("üìò 34 –°–ê–ë–ê“ö")
lessons = [f"{i}-—Å–∞–±–∞“õ" for i in range(1, 35)]
lesson_selected = st.sidebar.selectbox("–°–∞–±–∞“õ—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑", lessons)
st.sidebar.markdown("---")
mode = st.sidebar.radio("–†–µ–∂–∏–º", ["–û“õ—É—à—ã", "–ú“±“ì–∞–ª—ñ–º"])

st.title("üß™ –û—Ä–≥–∞–Ω–∏–∫–∞–ª—ã“õ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–ø—Ç–∞—Ä–¥—ã“£ —Å–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è–ª–∞—Ä—ã")
st.caption(f"–¢–∞“£–¥–∞–ª“ì–∞–Ω: {lesson_selected} | –†–µ–∂–∏–º: {mode}")

# ---------------- DATA ----------------
lesson_data = {
    1: {"topic": "–°–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è “±“ì—ã–º—ã",
        "theory": "–°–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è ‚Äì —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–ø—Ç—ã —Ä–µ–∞–∫—Ü–∏—è –±–µ–ª–≥—ñ—Å—ñ (—Ç“Ø—Å ”©–∑–≥–µ—Ä—É—ñ, —Ç“±–Ω–±–∞, –≥–∞–∑) –∞—Ä“õ—ã–ª—ã –∞–Ω—ã“õ—Ç–∞—É ”ô–¥—ñ—Å—ñ.",
        "lab": ("Br‚ÇÇ (–ë—Ä–æ–º —Å—É—ã)", "–¢“Ø—Å “õ—ã–∑—ã–ª-“õ–æ“£—ã—Ä–¥–∞–Ω —Ç“Ø—Å—Å—ñ–∑–≥–µ ”©–∑–≥–µ—Ä–µ–¥—ñ", "“ö–æ—Å—ã–ª—ã—Å—Ç–∞ –µ—Å–µ–ª—ñ (“õ–æ—Å –Ω–µ–º–µ—Å–µ “Ø—à) –±–∞–π–ª–∞–Ω—ã—Å –±–∞—Ä"),
        "ai": "–ë–µ—Ä—ñ–ª–≥–µ–Ω “õ–æ—Å—ã–ª—ã—Å—Ç—ã“£ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–±—ã–Ω AI –∞—Ä“õ—ã–ª—ã –±–æ–ª–∂–∞",
        "test": [
            ("Br‚ÇÇ –Ω–µ–Ω—ñ –∞–Ω—ã“õ—Ç–∞–π–¥—ã?", ["–ê–ª–∫–∞–Ω", "–ê–ª–∫–µ–Ω", "–°–ø–∏—Ä—Ç"], 1),
            ("–°–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è –º–∞“õ—Å–∞—Ç—ã?", ["–ë–µ–ª–≥—ñ –∞—Ä“õ—ã–ª—ã –∑–∞—Ç—Ç—ã —Ç–∞–Ω—É", "–ó–∞—Ç—Ç—ã“£ –±–∞“ì–∞—Å—ã–Ω –±—ñ–ª—É", "–ò—ñ—Å—ñ–Ω –∫–µ—Ç—ñ—Ä—É"], 0),
            ("“ö–∞–π “õ–æ—Å—ã–ª—ã—Å “õ–æ—Å –±–∞–π–ª–∞–Ω—ã—Å“õ–∞ –∏–µ?", ["CH‚ÇÑ", "C‚ÇÇH‚ÇÑ", "C‚ÇÇH‚ÇÜ"], 1),
            ("Br‚ÇÇ —Ä–µ–∞–∫—Ü–∏—è—Å—ã “õ–∞–ª–∞–π –∂“Ø—Ä–µ–¥—ñ?", ["–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É", "“ö—ã–∑–∞—Ä—É", "–ö”©–∫ —Ç“Ø—Å–∫–µ ”©–∑–≥–µ—Ä—É"], 0),
            ("“ö–æ—Å –±–∞–π–ª–∞–Ω—ã—Å“õ–∞ —Ç”ô–Ω —Ä–µ–∞–∫—Ç–∏–≤?", ["Br‚ÇÇ", "KMnO‚ÇÑ", "NaOH"], 0),
            ("–ê–ª–∫–µ–Ω–¥–µ—Ä–¥—ñ“£ –±—Ä–æ–º —Å—É—ã–º–µ–Ω —Ä–µ–∞–∫—Ü–∏—è—Å—ã?", ["“ö–∞–Ω—ã“õ–ø–∞“ì–∞–Ω–¥—ã“õ –±–µ–ª–≥—ñ—Å—ñ", "–°—ñ–ª—Ç—ñ–ª—ñ–∫ “õ–∞—Å–∏–µ—Ç", "“ö—ã—à“õ—ã–ª–¥—ã“õ “õ–∞—Å–∏–µ—Ç"], 0),
            ("–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É –±–∞–π“õ–∞–ª–∞—Ç—ã–Ω –∑–∞—Ç?", ["C‚ÇÇH‚ÇÑ", "CH‚ÇÑ", "C‚ÇÉH‚Çà"], 0),
            ("–°–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ç“Ø—Ä—ñ?", ["–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–ø—Ç—ã –∞–Ω—ã“õ—Ç–∞—É", "–ú–æ–ª–µ–∫—É–ª–∞–ª—ã“õ –º–∞—Å—Å–∞–Ω—ã ”©–ª—à–µ—É", "–ó–∞—Ç—Ç—ã –µ—Ä—ñ—Ç—É"], 0),
            ("–ë—Ä–æ–º —Å—É—ã–Ω—ã“£ —Ç“Ø—Å—ñ “õ–∞–Ω–¥–∞–π?", ["“ö—ã–∑—ã–ª-“õ–æ“£—ã—Ä", "–ö”©–∫", "–ú”©–ª–¥—ñ—Ä"], 0),
            ("–†–µ–∞–∫—Ü–∏—è–¥–∞–Ω –∫–µ–π—ñ–Ω –±—Ä–æ–º —Å—É—ã –Ω–µ –±–æ–ª–∞–¥—ã?", ["–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω–µ–¥—ñ", "“ö–∞—Ä–∞—è–¥—ã", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ"], 0)
        ]
    },
    2: {"topic": "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–ø—Ç–∞—Ä",
        "theory": "–û—Ä–≥–∞–Ω–∏–∫–∞–ª—ã“õ “õ–æ—Å—ã–ª—ã—Å—Ç–∞—Ä “õ“±—Ä–∞–º—ã–Ω–¥–∞“ì—ã –µ—Ä–µ–∫—à–µ –∞—Ç–æ–º–¥–∞—Ä —Ç–æ–±—ã–Ω–∞ –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä, “õ—ã—à“õ—ã–ª–¥–∞—Ä –∂”ô–Ω–µ —Ç.–±. –±–æ–ª—ã–ø –±”©–ª—ñ–Ω–µ–¥—ñ.",
        "lab": ("Cu(OH)‚ÇÇ", "–ê—à—ã“õ –∫”©–∫ —Ç“Ø—Å—Ç—ñ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ –ø–∞–π–¥–∞ –±–æ–ª–∞–¥—ã", "–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç (–º—ã—Å–∞–ª—ã, –≥–ª–∏—Ü–µ—Ä–∏–Ω) –±–∞—Ä –µ–∫–µ–Ω—ñ–Ω –∫”©—Ä—Å–µ—Ç–µ–¥—ñ"),
        "ai": "–ë–µ—Ä—ñ–ª–≥–µ–Ω —Ñ–æ—Ä–º—É–ª–∞–¥–∞–Ω —Ç–æ–ø—Ç—ã –∞–Ω—ã“õ—Ç–∞",
        "test": [
            ("‚ÄìOH “õ–∞–π —Ç–æ–ø“õ–∞ —Ç”ô–Ω?", ["–ê–º–∏–Ω", "–°–ø–∏—Ä—Ç", "“ö—ã—à“õ—ã–ª"], 1),
            ("–°–ø–∏—Ä—Ç—Ç—ñ“£ —Å–∞–ø–∞–ª—ã“õ –±–µ–ª–≥—ñ—Å—ñ (Cu(OH)‚ÇÇ)?", ["–ê—à—ã“õ –∫”©–∫ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ", "–ì–∞–∑ —à—ã“ì—É—ã", "–¢“Ø—Å—Å—ñ–∑–¥–µ–Ω—É"], 0),
            ("–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–¥—ã“õ —Ç–æ–ø –Ω–µ “Ø—à—ñ–Ω –∫–µ—Ä–µ–∫?", ["–•–∏–º–∏—è–ª—ã“õ “õ–∞—Å–∏–µ—Ç—Ç—ñ –∞–Ω—ã“õ—Ç–∞—É", "–ó–∞—Ç—Ç—ã“£ —Å–∞–ª–º–∞“ì—ã–Ω –∞—Ä—Ç—Ç—ã—Ä—É", "–¢“Ø—Å—ñ–Ω ”ô–¥–µ–º—ñ–ª–µ—É"], 0),
            ("‚ÄìCOOH “õ–∞–π —Ç–æ–ø?", ["–°–ø–∏—Ä—Ç", "–ö–∞—Ä–±–æ–Ω “õ—ã—à“õ—ã–ª—ã", "–ê–º–∏–Ω"], 1),
            ("‚ÄìNH‚ÇÇ “õ–∞–π —Ç–æ–ø?", ["–ê–º–∏–Ω", "“ö—ã—à“õ—ã–ª", "–ê–ª—å–¥–µ–≥–∏–¥"], 0),
            ("‚ÄìCHO “õ–∞–π —Ç–æ–ø?", ["–ê–ª—å–¥–µ–≥–∏–¥", "–ö–µ—Ç–æ–Ω", "–≠—Ñ–∏—Ä"], 0),
            ("–ì–ª–∏—Ü–µ—Ä–∏–Ω–≥–µ Cu(OH)‚ÇÇ “õ–æ—Å—Å–∞“õ –Ω–µ –±–æ–ª–∞–¥—ã?", ["–ö”©–∫ –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ", "–ê“õ —Ç“±–Ω–±–∞", "–ñ–∞—Å—ã–ª —Ç“Ø—Å"], 0),
            ("–°–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ“£ –∂–∞–ª–ø—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã–Ω–¥–∞“ì—ã —Ç–æ–ø?", ["‚ÄìOH", "‚ÄìCH‚ÇÉ", "‚ÄìCOOH"], 0),
            ("–°–∞–ø–∞–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è–¥–∞ –Ω–µ –±–∞–π“õ–∞–ª–∞–¥—ã?", ["–°—ã—Ä—Ç“õ—ã –±–µ–ª–≥—ñ", "–¢–µ–∫ “õ—ã—Å—ã–º", "–¢–µ–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞"], 0),
            ("–ö”©–ø –∞—Ç–æ–º–¥—ã —Å–ø–∏—Ä—Ç—Ç–µ—Ä–¥—ñ –∞–Ω—ã“õ—Ç–∞–π—Ç—ã–Ω —Ä–µ–∞–∫—Ç–∏–≤?", ["Cu(OH)‚ÇÇ", "Br‚ÇÇ", "AgNO‚ÇÉ"], 0)
        ]
    }
}

# ---------------- UI FUNCTIONS ----------------
def show_theory(text):
    st.subheader("üìñ –¢–µ–æ—Ä–∏—è")
    st.info(text)

def show_lab(reagents, observation, conclusion):
    st.subheader("üî¨ –í–∏—Ä—Ç—É–∞–ª–¥—ã –∑–µ—Ä—Ç—Ö–∞–Ω–∞")
    st.write(f"**–†–µ–∞–∫—Ç–∏–≤—Ç–µ—Ä:** {reagents}")
    
    if st.button("–†–µ–∞–∫—Ü–∏—è–Ω—ã –±–∞—Å—Ç–∞—É"):
        progress_bar = st.progress(0)
        status_text = st.empty()
        for i in range(1, 101):
            time.sleep(0.01)
            progress_bar.progress(i)
            if i < 30: status_text.text("üß™ –†–µ–∞–∫—Ç–∏–≤—Ç–µ—Ä –∞—Ä–∞–ª–∞—Å—É–¥–∞...")
            elif i < 70: status_text.text(f"üëÄ –ë–∞“õ—ã–ª–∞—É: {observation}")
            else: status_text.text(f"‚úÖ “ö–æ—Ä—ã—Ç—ã–Ω–¥—ã: {conclusion}")

def show_ai(task):
    st.subheader("ü§ñ AI –¢–∞–ø—Å—ã—Ä–º–∞")
    st.write(task)
    user_answer = st.text_input("–ñ–∞—É–∞–±—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑:", key=f"ai_in_{lesson_selected}")
    if st.button("AI-–¥–∞–Ω –∫”©–º–µ–∫"):
        st.success("–ë“±–ª —Ç–æ–ø—Ç—ã“£ “õ–∞—Å–∏–µ—Ç—ñ –æ–Ω—ã“£ “õ“±—Ä–∞–º—ã–Ω–¥–∞“ì—ã —ç–ª–µ–∫—Ç—Ä–æ–Ω–¥–∞—Ä–¥—ã“£ —Ç—ã“ì—ã–∑–¥—ã“ì—ã–Ω–∞ –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã...")

def show_test(test_items):
    st.subheader("üìù –¢–µ—Å—Ç")
    user_selections = []
    
    # –°“±—Ä–∞“õ—Ç–∞—Ä–¥—ã —à—ã“ì–∞—Ä—É
    for idx, (q, opts, correct) in enumerate(test_items):
        # index=None –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã —Ç–∞“£–¥–∞—É –∂–∞—Å–∞“ì–∞–Ω—à–∞ –±–æ—Å —Ç“±—Ä–∞–¥—ã
        ans = st.radio(f"{idx+1}. {q}", opts, index=None, key=f"test_{lesson_selected}_{idx}")
        user_selections.append(ans)

    st.markdown("---")
    if st.button("–ù”ô—Ç–∏–∂–µ–Ω—ñ —Ç–µ–∫—Å–µ—Ä—É"):
        score = 0
        for i, ans in enumerate(user_selections):
            if ans is not None:
                correct_idx = test_items[i][2]
                if ans == test_items[i][1][correct_idx]:
                    score += 1
        
        if score == len(test_items):
            st.balloons()
            st.success(f"–ö–µ—Ä–µ–º–µ—Ç! “∞–ø–∞–π: {score} / {len(test_items)}")
        else:
            st.warning(f"–ù”ô—Ç–∏–∂–µ: {score} / {len(test_items)}. “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “õ–∞–π—Ç–∞–ª–∞“£—ã–∑.")
    else:
        st.info(f"–ê“ì—ã–º–¥–∞“ì—ã “±–ø–∞–π: 0 / {len(test_items)}")

# ---------------- MAIN CONTENT ----------------
lesson_num = int(lesson_selected.split("-")[0])
data = lesson_data.get(lesson_num)

if data:
    st.header(f"{lesson_num}-—Å–∞–±–∞“õ. {data['topic']}")
    tab1, tab2, tab3 = st.tabs(["üìö –û“õ—É", "üß™ –¢”ô–∂—ñ—Ä–∏–±–µ", "‚úçÔ∏è –¢–µ—Å—Ç"])
    
    with tab1:
        show_theory(data["theory"])
        show_ai(data["ai"])
    
    with tab2:
        show_lab(*data["lab"])
        
    with tab3:
        show_test(data["test"])
else:
    st.warning("–ë“±–ª —Å–∞–±–∞“õ—Ç—ã“£ –º–∞–∑–º“±–Ω—ã ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ...")

st.markdown("---")
st.caption("¬©Ô∏è Chemistry + AI | Streamlit –æ“õ—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Å—ã")
